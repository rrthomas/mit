#!/usr/bin/env python3

from vm_data import Actions

print('// Auto-generated by gen-actions - DO NOT EDIT.\n')

print('''\
#define RAISE(code)                             \\
        do {                                    \\
            int error = (code);                 \\ 
            if (error != 0)                     \\
                return error;                   \\
        } while(0)

static int STEP(smite_state *S) {
    S->ITYPE = smite_decode_instruction(S, &S->PC, &S->I);
    trace(S->ITYPE, S->I);

    switch (S->ITYPE) {
    case INSTRUCTION_NUMBER:
        PUSH(S->I);
        break;
    case INSTRUCTION_ACTION:
        switch (S->I) {''')
for (instruction, action) in Actions.__members__.items():
    print('''\
        case O_{}:
            {{
{}
            }}
            break;'''.format(
        instruction,
        action.value.code.replace('        ', '                '),
    ))
print('''\
        default: /* Undefined instruction */
            return -256;
        }
        break;
    default: /* Error during instruction fetch */
        return S->ITYPE;
    }
    return 0;
}''')
